<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gimnasio - Sistema de Gesti√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Screen */
        .login-screen {
            padding: 50px;
            text-align: center;
        }

        .login-screen h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .login-options {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-top: 40px;
        }

        .login-btn {
            padding: 20px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .login-btn.primary {
            background: #667eea;
            color: white;
        }

        .login-btn.secondary {
            background: #48bb78;
            color: white;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* User Selection */
        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .user-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
        }

        .user-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .user-card .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .badge.socio {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge.entrenador {
            background: #fbd38d;
            color: #7c2d12;
        }

        /* Main Interface */
        .main-interface {
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h2 {
            font-size: 1.8em;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        .nav-tabs {
            display: flex;
            background: #f7fafc;
            border-bottom: 2px solid #e2e8f0;
            padding: 0 40px;
        }

        .nav-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #718096;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            color: #667eea;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .content {
            padding: 40px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-secondary {
            background: #cbd5e0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #a0aec0;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .data-table thead {
            background: #667eea;
            color: white;
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
        }

        .data-table tbody tr {
            border-bottom: 1px solid #e2e8f0;
            transition: background 0.3s;
        }

        .data-table tbody tr:hover {
            background: #f7fafc;
        }

        .data-table .action-btn {
            padding: 6px 12px;
            font-size: 0.9em;
            margin-right: 5px;
        }

        /* Cards */
        .card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
        }

        .info-value {
            color: #2d3748;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2d3748;
            font-size: 1.8em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #718096;
        }

        .close-btn:hover {
            color: #2d3748;
        }

        /* Alert Messages */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .alert-info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Back button */
        .back-btn {
            background: #cbd5e0;
            color: #2d3748;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: #a0aec0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-options {
                flex-direction: column;
            }

            .user-list {
                grid-template-columns: 1fr;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .nav-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <h1>üèãÔ∏è Sistema de Gesti√≥n - Gimnasio</h1>
            <p style="color: #718096; font-size: 1.1em; margin-top: 10px;">Bienvenido al sistema de gesti√≥n del gimnasio</p>
            <div class="login-options">
                <button class="login-btn primary" onclick="showUserSelection()">Iniciar Sesi√≥n</button>
                <button class="login-btn secondary" onclick="showRegisterForm()">Registrarse</button>
            </div>
        </div>

        <!-- User Selection Screen -->
        <div id="userSelectionScreen" class="login-screen hidden">
            <button class="back-btn" onclick="backToLogin()">‚Üê Volver</button>
            <h1>Selecciona tu usuario</h1>
            <div id="alertContainer"></div>
            <div id="userList" class="user-list">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Register Form Screen -->
        <div id="registerScreen" class="login-screen hidden">
            <button class="back-btn" onclick="backToLogin()">‚Üê Volver</button>
            <h1>Registro de Nuevo Socio</h1>
            <div id="registerAlert"></div>
            <form id="registerForm" style="max-width: 500px; margin: 30px auto; text-align: left;">
                <div class="form-group">
                    <label>Nombre *</label>
                    <input type="text" id="regNombre" required>
                </div>
                <div class="form-group">
                    <label>Apellidos *</label>
                    <input type="text" id="regApellidos" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label>Tel√©fono *</label>
                    <input type="tel" id="regTelefono" required>
                </div>
                <div class="form-group">
                    <label>Plan *</label>
                    <select id="regPlan" required>
                        <option value="">Selecciona un plan</option>
                        <option value="BASICO">B√ÅSICO</option>
                        <option value="PREMIUM">PREMIUM</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;">Registrarse</button>
            </form>
        </div>

        <!-- Main Interface -->
        <div id="mainInterface" class="main-interface">
            <div class="header">
                <div>
                    <h2 id="welcomeMessage">Bienvenido</h2>
                    <p id="userInfo" style="margin-top: 5px; opacity: 0.9;"></p>
                </div>
                <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>

            <div class="nav-tabs" id="navTabs"></div>

            <div class="content">
                <div id="mainAlert"></div>
                <div id="tabContents"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modal</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserType = null;
        const API_BASE = '/api';

        // Utility functions
        function showAlert(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type} show">${message}</div>`;
            setTimeout(() => {
                const alert = container.querySelector('.alert');
                if (alert) alert.classList.remove('show');
            }, 5000);
        }

        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Navigation functions
        function backToLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('userSelectionScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
        }

        async function showUserSelection() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('userSelectionScreen').classList.remove('hidden');
            await loadUsers();
        }

        function showRegisterForm() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        }

        function logout() {
            currentUser = null;
            currentUserType = null;
            document.getElementById('mainInterface').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        // Load users
        async function loadUsers() {
            const userListDiv = document.getElementById('userList');
            userListDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const [sociosRes, entrenadoresRes] = await Promise.all([
                    fetch(`${API_BASE}/socios?size=100`),
                    fetch(`${API_BASE}/entrenadores?size=100`)
                ]);

                const sociosData = await sociosRes.json();
                const entrenadoresData = await entrenadoresRes.json();

                const socios = sociosData.content || [];
                const entrenadores = entrenadoresData.content || [];

                let html = '';

                socios.forEach(socio => {
                    html += `
                        <div class="user-card" onclick="selectUser(${socio.idSocio}, 'socio')">
                            <h3>${socio.nombre} ${socio.apellidos}</h3>
                            <span class="badge socio">Socio</span>
                            <p style="margin-top: 10px; color: #718096; font-size: 0.9em;">Plan: ${socio.tipoPlan}</p>
                        </div>
                    `;
                });

                entrenadores.forEach(entrenador => {
                    html += `
                        <div class="user-card" onclick="selectUser(${entrenador.idSocio}, 'entrenador')">
                            <h3>${entrenador.nombre} ${entrenador.apellidos}</h3>
                            <span class="badge entrenador">Entrenador</span>
                            <p style="margin-top: 10px; color: #718096; font-size: 0.9em;">Especialidad: ${entrenador.especialidad}</p>
                        </div>
                    `;
                });

                userListDiv.innerHTML = html || '<p>No hay usuarios disponibles</p>';
            } catch (error) {
                userListDiv.innerHTML = '<p style="color: red;">Error al cargar usuarios</p>';
                console.error('Error:', error);
            }
        }

        // Select user and login
        async function selectUser(userId, userType) {
            try {
                const endpoint = userType === 'socio' ? 'socios' : 'entrenadores';
                const res = await fetch(`${API_BASE}/${endpoint}/${userId}`);
                const userData = await res.json();

                currentUser = userData;
                currentUserType = userType;

                document.getElementById('userSelectionScreen').classList.add('hidden');
                document.getElementById('mainInterface').style.display = 'block';
                document.getElementById('welcomeMessage').textContent =
                    `Bienvenido, ${userData.nombre} ${userData.apellidos}`;
                document.getElementById('userInfo').textContent =
                    userType === 'socio' ? `Socio - Plan ${userData.tipoPlan}` : `Entrenador - ${userData.especialidad}`;

                if (userType === 'socio') {
                    loadSocioInterface();
                } else {
                    loadEntrenadorInterface();
                }
            } catch (error) {
                showAlert('alertContainer', 'Error al cargar usuario', 'error');
                console.error('Error:', error);
            }
        }

        // Register form
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const socioData = {
                nombre: document.getElementById('regNombre').value,
                apellidos: document.getElementById('regApellidos').value,
                email: document.getElementById('regEmail').value,
                telefono: document.getElementById('regTelefono').value,
                tipoPlan: document.getElementById('regPlan').value
            };

            try {
                const res = await fetch(`${API_BASE}/socios`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(socioData)
                });

                if (res.ok) {
                    const newSocio = await res.json();
                    showAlert('registerAlert', '¬°Registro exitoso! Redirigiendo...', 'success');
                    setTimeout(() => {
                        selectUser(newSocio.idSocio, 'socio');
                    }, 1500);
                } else {
                    const error = await res.json();
                    showAlert('registerAlert', error.message || 'Error al registrar', 'error');
                }
            } catch (error) {
                showAlert('registerAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        });

        // SOCIO INTERFACE
        function loadSocioInterface() {
            const navTabs = document.getElementById('navTabs');
            const tabContents = document.getElementById('tabContents');

            navTabs.innerHTML = `
                <button class="nav-tab active" onclick="switchTab('bonos')">Bonos</button>
                <button class="nav-tab" onclick="switchTab('plan')">Plan Actual</button>
                <button class="nav-tab" onclick="switchTab('reservas')">Reservas</button>
            `;

            tabContents.innerHTML = `
                <div id="tab-bonos" class="tab-content active">
                    <h2>Mis Bonos</h2>
                    <button class="btn btn-success" onclick="showCreateBonoForm()" style="margin: 20px 0;">+ Obtener Nuevo Bono</button>
                    <div id="bonosList"></div>
                </div>
                <div id="tab-plan" class="tab-content">
                    <h2>Mi Plan Actual</h2>
                    <div id="planInfo"></div>
                </div>
                <div id="tab-reservas" class="tab-content">
                    <h2>Mis Reservas</h2>
                    <button class="btn btn-success" onclick="showCreateReservaForm()" style="margin: 20px 0;">+ Nueva Reserva</button>
                    <div id="reservasList"></div>
                </div>
            `;

            loadSocioBonos();
            loadSocioPlan();
            loadSocioReservas();
        }

        async function loadSocioBonos() {
            const bonosDiv = document.getElementById('bonosList');
            bonosDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const res = await fetch(`${API_BASE}/bonos/socio/${currentUser.idSocio}`);
                const bonos = await res.json();

                if (bonos.length === 0) {
                    bonosDiv.innerHTML = '<p>No tienes bonos activos</p>';
                    return;
                }

                let html = '<div class="card-grid">';
                bonos.forEach(bono => {
                    html += `
                        <div class="card">
                            <h3>Bono #${bono.idBono}</h3>
                            <div class="info-item">
                                <span class="info-label">Entrenador:</span>
                                <span class="info-value">${bono.nombreEntrenador}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Sesiones Totales:</span>
                                <span class="info-value">${bono.sesionesTotales}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Sesiones Restantes:</span>
                                <span class="info-value" style="color: ${bono.sesionesRestantes > 0 ? '#48bb78' : '#f56565'}; font-weight: bold;">
                                    ${bono.sesionesRestantes}
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Fecha Compra:</span>
                                <span class="info-value">${new Date(bono.fechaCompra).toLocaleDateString()}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Estado:</span>
                                <span class="info-value" style="color: ${bono.activo ? '#48bb78' : '#f56565'}">
                                    ${bono.activo ? 'Activo' : 'Inactivo'}
                                </span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                bonosDiv.innerHTML = html;
            } catch (error) {
                bonosDiv.innerHTML = '<p style="color: red;">Error al cargar bonos</p>';
                console.error('Error:', error);
            }
        }

        async function showCreateBonoForm() {
            try {
                const res = await fetch(`${API_BASE}/entrenadores?size=100`);
                const data = await res.json();
                const entrenadores = data.content || [];

                let html = `
                    <form id="createBonoForm">
                        <div class="form-group">
                            <label>Selecciona un Entrenador *</label>
                            <select id="bonoEntrenador" required>
                                <option value="">Selecciona...</option>
                                ${entrenadores.map(e =>
                                    `<option value="${e.idSocio}">${e.nombre} ${e.apellidos} - ${e.especialidad}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <p style="color: #718096; margin: 15px 0;">Se crear√° un bono de 10 sesiones con el entrenador seleccionado.</p>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Crear Bono</button>
                    </form>
                `;

                openModal('Obtener Nuevo Bono', html);

                document.getElementById('createBonoForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const idEntrenador = document.getElementById('bonoEntrenador').value;

                    try {
                        const res = await fetch(`${API_BASE}/bonos`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                idSocio: currentUser.idSocio,
                                idEntrenador: parseInt(idEntrenador)
                            })
                        });

                        if (res.ok) {
                            closeModal();
                            showAlert('mainAlert', 'Bono creado exitosamente', 'success');
                            loadSocioBonos();
                        } else {
                            const error = await res.json();
                            showAlert('mainAlert', error.message || 'Error al crear bono', 'error');
                        }
                    } catch (error) {
                        showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                        console.error('Error:', error);
                    }
                });
            } catch (error) {
                showAlert('mainAlert', 'Error al cargar entrenadores', 'error');
            }
        }

        async function loadSocioPlan() {
            const planDiv = document.getElementById('planInfo');

            let html = `
                <div class="card">
                    <h3>Plan ${currentUser.tipoPlan}</h3>
                    <div class="info-item">
                        <span class="info-label">Tipo de Plan:</span>
                        <span class="info-value">${currentUser.tipoPlan}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Fecha de Alta:</span>
                        <span class="info-value">${new Date(currentUser.fechaAlta).toLocaleDateString()}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Estado:</span>
                        <span class="info-value" style="color: ${currentUser.esActivo ? '#48bb78' : '#f56565'}">
                            ${currentUser.esActivo ? 'Activo' : 'Inactivo'}
                        </span>
                    </div>
                    ${currentUser.tipoPlan === 'BASICO' ? `
                        <div style="margin-top: 20px; padding: 15px; background: #fff5f5; border-radius: 8px; border: 1px solid #feb2b2;">
                            <p style="color: #742a2a; margin-bottom: 10px;">Con el plan B√ÅSICO solo puedes acceder a clases privadas.</p>
                            <button class="btn btn-primary" onclick="cambiarPlan('PREMIUM')">Actualizar a PREMIUM</button>
                        </div>
                    ` : `
                        <div style="margin-top: 20px; padding: 15px; background: #f0fff4; border-radius: 8px; border: 1px solid #9ae6b4;">
                            <p style="color: #22543d;">‚úì Tienes acceso a clases privadas y grupales</p>
                        </div>
                    `}
                </div>
            `;

            planDiv.innerHTML = html;
        }

        async function cambiarPlan(nuevoPlan) {
            try {
                const res = await fetch(`${API_BASE}/socios/${currentUser.idSocio}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...currentUser,
                        tipoPlan: nuevoPlan
                    })
                });

                if (res.ok) {
                    currentUser.tipoPlan = nuevoPlan;
                    showAlert('mainAlert', `Plan actualizado a ${nuevoPlan}`, 'success');
                    loadSocioPlan();
                    document.getElementById('userInfo').textContent = `Socio - Plan ${nuevoPlan}`;
                } else {
                    showAlert('mainAlert', 'Error al cambiar plan', 'error');
                }
            } catch (error) {
                showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        }

        async function loadSocioReservas() {
            const reservasDiv = document.getElementById('reservasList');
            reservasDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const res = await fetch(`${API_BASE}/reservas/buscar?idSocio=${currentUser.idSocio}&size=100`);
                const data = await res.json();
                const reservas = data.content || [];

                if (reservas.length === 0) {
                    reservasDiv.innerHTML = '<p>No tienes reservas</p>';
                    return;
                }

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Clase</th>
                                <th>Horario</th>
                                <th>Fecha Reserva</th>
                                <th>Estado</th>
                                <th>Bono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                reservas.forEach(reserva => {
                    html += `
                        <tr>
                            <td>${reserva.idReserva}</td>
                            <td>${reserva.nombreClase}</td>
                            <td>${reserva.horario ? `${reserva.horario.horaInicio} - ${reserva.horario.horaFin}` : 'N/A'}</td>
                            <td>${new Date(reserva.fechaReservar).toLocaleString()}</td>
                            <td><span style="color: ${getEstadoColor(reserva.estado)}">${reserva.estado}</span></td>
                            <td>${reserva.idBono || 'N/A'}</td>
                            <td>
                                ${reserva.estado === 'CONFIRMADA' ?
                                    `<button class="btn btn-danger action-btn" onclick="cancelarReserva(${reserva.idReserva})">Cancelar</button>`
                                    : ''}
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                reservasDiv.innerHTML = html;
            } catch (error) {
                reservasDiv.innerHTML = '<p style="color: red;">Error al cargar reservas</p>';
                console.error('Error:', error);
            }
        }

        function getEstadoColor(estado) {
            switch(estado) {
                case 'CONFIRMADA': return '#48bb78';
                case 'CANCELADA': return '#f56565';
                case 'COMPLETADA': return '#667eea';
                default: return '#718096';
            }
        }

        async function cancelarReserva(idReserva) {
            if (!confirm('¬øEst√°s seguro de cancelar esta reserva?')) return;

            try {
                const res = await fetch(`${API_BASE}/reservas/${idReserva}/cancelar`, {
                    method: 'PUT'
                });

                if (res.ok) {
                    showAlert('mainAlert', 'Reserva cancelada', 'success');
                    loadSocioReservas();
                } else {
                    showAlert('mainAlert', 'Error al cancelar reserva', 'error');
                }
            } catch (error) {
                showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        }

        async function showCreateReservaForm() {
            try {
                // Cargar clases disponibles seg√∫n el plan del socio
                const clasesRes = await fetch(`${API_BASE}/clases?size=100`);
                const clasesData = await clasesRes.json();
                let clases = clasesData.content || [];

                // Filtrar clases seg√∫n el plan
                if (currentUser.tipoPlan === 'BASICO') {
                    // Solo clases privadas
                    clases = clases.filter(c => c.esPrivada);
                }

                // Cargar bonos activos del socio
                const bonosRes = await fetch(`${API_BASE}/bonos/socio/${currentUser.idSocio}`);
                const bonos = await bonosRes.json();
                const bonosActivos = bonos.filter(b => b.activo && b.sesionesRestantes > 0);

                let html = `
                    <form id="createReservaForm">
                        <div class="form-group">
                            <label>Selecciona una Clase *</label>
                            <select id="reservaClase" required>
                                <option value="">Selecciona...</option>
                                ${clases.map(c =>
                                    `<option value="${c.idClase}" data-privada="${c.esPrivada}">
                                        ${c.nombre} - ${c.fechaClase} (${c.horario.horaInicio} - ${c.horario.horaFin})
                                        ${c.esPrivada ? '[PRIVADA]' : '[GRUPAL]'}
                                    </option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group" id="bonoGroup" style="display: none;">
                            <label>Selecciona un Bono * (Requerido para clases privadas)</label>
                            <select id="reservaBono">
                                <option value="">Selecciona...</option>
                                ${bonosActivos.map(b =>
                                    `<option value="${b.idBono}">
                                        Bono #${b.idBono} - ${b.nombreEntrenador} (${b.sesionesRestantes} sesiones restantes)
                                    </option>`
                                ).join('')}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Crear Reserva</button>
                    </form>
                `;

                openModal('Nueva Reserva', html);

                // Mostrar/ocultar campo de bono seg√∫n el tipo de clase
                document.getElementById('reservaClase').addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const esPrivada = selectedOption.getAttribute('data-privada') === 'true';
                    const bonoGroup = document.getElementById('bonoGroup');

                    if (esPrivada) {
                        bonoGroup.style.display = 'block';
                        document.getElementById('reservaBono').required = true;
                    } else {
                        bonoGroup.style.display = 'none';
                        document.getElementById('reservaBono').required = false;
                        document.getElementById('reservaBono').value = '';
                    }
                });

                document.getElementById('createReservaForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const idClase = document.getElementById('reservaClase').value;
                    const idBono = document.getElementById('reservaBono').value || null;

                    try {
                        const res = await fetch(`${API_BASE}/reservas`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                idClase: parseInt(idClase),
                                idSocio: currentUser.idSocio,
                                idBono: idBono ? parseInt(idBono) : null
                            })
                        });

                        if (res.ok) {
                            closeModal();
                            showAlert('mainAlert', 'Reserva creada exitosamente', 'success');
                            loadSocioReservas();
                            loadSocioBonos(); // Actualizar bonos por si se us√≥ una sesi√≥n
                        } else {
                            const error = await res.json();
                            showAlert('mainAlert', error.message || 'Error al crear reserva', 'error');
                        }
                    } catch (error) {
                        showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                        console.error('Error:', error);
                    }
                });
            } catch (error) {
                showAlert('mainAlert', 'Error al cargar datos', 'error');
                console.error('Error:', error);
            }
        }

        // ENTRENADOR INTERFACE
        function loadEntrenadorInterface() {
            const navTabs = document.getElementById('navTabs');
            const tabContents = document.getElementById('tabContents');

            navTabs.innerHTML = `
                <button class="nav-tab active" onclick="switchTab('clases-ent')">Clases</button>
                <button class="nav-tab" onclick="switchTab('entrenadores-ent')">Entrenadores</button>
                <button class="nav-tab" onclick="switchTab('horarios-ent')">Horarios</button>
                <button class="nav-tab" onclick="switchTab('socios-ent')">Socios</button>
            `;

            tabContents.innerHTML = `
                <div id="tab-clases-ent" class="tab-content active">
                    <h2>Gesti√≥n de Clases</h2>
                    <button class="btn btn-success" onclick="showCreateClaseForm()" style="margin: 20px 0;">+ Nueva Clase</button>
                    <div id="clasesList"></div>
                </div>
                <div id="tab-entrenadores-ent" class="tab-content">
                    <h2>Gesti√≥n de Entrenadores</h2>
                    <button class="btn btn-success" onclick="showCreateEntrenadorForm()" style="margin: 20px 0;">+ Nuevo Entrenador</button>
                    <div id="entrenadoresList"></div>
                </div>
                <div id="tab-horarios-ent" class="tab-content">
                    <h2>Gesti√≥n de Horarios</h2>
                    <button class="btn btn-success" onclick="showCreateHorarioForm()" style="margin: 20px 0;">+ Nuevo Horario</button>
                    <div id="horariosList"></div>
                </div>
                <div id="tab-socios-ent" class="tab-content">
                    <h2>Gesti√≥n de Socios</h2>
                    <div id="sociosList"></div>
                </div>
            `;

            loadEntrenadorClases();
            loadEntrenadores();
            loadHorarios();
            loadSocios();
        }

        async function loadEntrenadorClases() {
            const clasesDiv = document.getElementById('clasesList');
            clasesDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const res = await fetch(`${API_BASE}/clases?size=100`);
                const data = await res.json();
                const clases = data.content || [];

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Tipo</th>
                                <th>Fecha</th>
                                <th>Horario</th>
                                <th>Entrenador</th>
                                <th>Aforo</th>
                                <th>Reservas</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                clases.forEach(clase => {
                    const esMiClase = clase.idEntrenador === currentUser.idSocio;
                    html += `
                        <tr style="${esMiClase ? 'background: #f0fff4;' : ''}">
                            <td>${clase.idClase}</td>
                            <td>${clase.nombre}</td>
                            <td>${clase.esPrivada ? 'Privada' : 'Grupal'}</td>
                            <td>${clase.fechaClase}</td>
                            <td>${clase.horario.horaInicio} - ${clase.horario.horaFin}</td>
                            <td>${clase.nombreEntrenador}</td>
                            <td>${clase.aforoMaximo}</td>
                            <td>${clase.reservasConfirmadas || 0}</td>
                            <td>
                                ${esMiClase ?
                                    `<button class="btn btn-primary action-btn" onclick="editarClase(${clase.idClase})">Editar</button>
                                    <button class="btn btn-danger action-btn" onclick="eliminarClase(${clase.idClase})">Eliminar</button>`
                                    : '<span style="color: #718096;">No editable</span>'}
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                clasesDiv.innerHTML = html;
            } catch (error) {
                clasesDiv.innerHTML = '<p style="color: red;">Error al cargar clases</p>';
                console.error('Error:', error);
            }
        }

        async function showCreateClaseForm() {
            try {
                const horariosRes = await fetch(`${API_BASE}/horarios`);
                const horarios = await horariosRes.json();

                let html = `
                    <form id="createClaseForm">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="claseNombre" required>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="claseDescripcion" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Fecha de la Clase *</label>
                            <input type="date" id="claseFecha" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Clase *</label>
                            <select id="claseTipo" required>
                                <option value="false">Grupal</option>
                                <option value="true">Privada</option>
                            </select>
                        </div>
                        <div class="form-group" id="aforoGroup">
                            <label>Aforo M√°ximo *</label>
                            <input type="number" id="claseAforo" min="1" max="50">
                        </div>
                        <div class="form-group">
                            <label>Horario *</label>
                            <select id="claseHorario" required>
                                <option value="">Selecciona...</option>
                                ${horarios.map(h =>
                                    `<option value="${h.idHorario}">${h.horaInicio} - ${h.horaFin}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <input type="hidden" id="claseEntrenador" value="${currentUser.idSocio}">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Crear Clase</button>
                    </form>
                `;

                openModal('Nueva Clase', html);

                // Manejar cambio de tipo de clase
                document.getElementById('claseTipo').addEventListener('change', function() {
                    const aforoGroup = document.getElementById('aforoGroup');
                    if (this.value === 'true') {
                        aforoGroup.style.display = 'none';
                        document.getElementById('claseAforo').required = false;
                    } else {
                        aforoGroup.style.display = 'block';
                        document.getElementById('claseAforo').required = true;
                    }
                });

                document.getElementById('createClaseForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const esPrivada = document.getElementById('claseTipo').value === 'true';
                    const claseData = {
                        nombre: document.getElementById('claseNombre').value,
                        descripcion: document.getElementById('claseDescripcion').value,
                        fechaClase: document.getElementById('claseFecha').value,
                        esPrivada: esPrivada,
                        aforoMaximo: esPrivada ? null : parseInt(document.getElementById('claseAforo').value),
                        idHorario: parseInt(document.getElementById('claseHorario').value),
                        idEntrenador: currentUser.idSocio
                    };

                    try {
                        const res = await fetch(`${API_BASE}/clases`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(claseData)
                        });

                        if (res.ok) {
                            closeModal();
                            showAlert('mainAlert', 'Clase creada exitosamente', 'success');
                            loadEntrenadorClases();
                        } else {
                            const error = await res.json();
                            showAlert('mainAlert', error.message || 'Error al crear clase', 'error');
                        }
                    } catch (error) {
                        showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                        console.error('Error:', error);
                    }
                });
            } catch (error) {
                showAlert('mainAlert', 'Error al cargar datos', 'error');
            }
        }

        async function editarClase(idClase) {
            try {
                const claseRes = await fetch(`${API_BASE}/clases/${idClase}`);
                const clase = await claseRes.json();

                const horariosRes = await fetch(`${API_BASE}/horarios`);
                const horarios = await horariosRes.json();

                let html = `
                    <form id="editClaseForm">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="editClaseNombre" value="${clase.nombre}" required>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="editClaseDescripcion" rows="3">${clase.descripcion || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Fecha de la Clase *</label>
                            <input type="date" id="editClaseFecha" value="${clase.fechaClase}" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Clase *</label>
                            <select id="editClaseTipo" required>
                                <option value="false" ${!clase.esPrivada ? 'selected' : ''}>Grupal</option>
                                <option value="true" ${clase.esPrivada ? 'selected' : ''}>Privada</option>
                            </select>
                        </div>
                        <div class="form-group" id="editAforoGroup" style="${clase.esPrivada ? 'display: none;' : ''}">
                            <label>Aforo M√°ximo *</label>
                            <input type="number" id="editClaseAforo" value="${clase.aforoMaximo || ''}" min="1" max="50">
                        </div>
                        <div class="form-group">
                            <label>Horario *</label>
                            <select id="editClaseHorario" required>
                                ${horarios.map(h =>
                                    `<option value="${h.idHorario}" ${h.idHorario === clase.horario.idHorario ? 'selected' : ''}>
                                        ${h.horaInicio} - ${h.horaFin}
                                    </option>`
                                ).join('')}
                            </select>
                        </div>
                        <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border: 1px solid #feb2b2; margin: 15px 0;">
                            <p style="color: #742a2a; font-size: 0.9em; margin: 0;">
                                ‚ö†Ô∏è Nota: Al actualizar la clase, se eliminar√° la clase anterior y se crear√° una nueva con los datos modificados.
                                Las reservas existentes se mantendr√°n asociadas a la nueva clase autom√°ticamente.
                            </p>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Actualizar Clase</button>
                    </form>
                `;

                openModal('Editar Clase', html);

                document.getElementById('editClaseTipo').addEventListener('change', function() {
                    const aforoGroup = document.getElementById('editAforoGroup');
                    if (this.value === 'true') {
                        aforoGroup.style.display = 'none';
                        document.getElementById('editClaseAforo').required = false;
                    } else {
                        aforoGroup.style.display = 'block';
                        document.getElementById('editClaseAforo').required = true;
                    }
                });

                document.getElementById('editClaseForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const esPrivada = document.getElementById('editClaseTipo').value === 'true';
                    const claseData = {
                        nombre: document.getElementById('editClaseNombre').value,
                        descripcion: document.getElementById('editClaseDescripcion').value || null,
                        fechaClase: document.getElementById('editClaseFecha').value,
                        esPrivada: esPrivada,
                        aforoMaximo: esPrivada ? null : parseInt(document.getElementById('editClaseAforo').value),
                        idHorario: parseInt(document.getElementById('editClaseHorario').value),
                        idEntrenador: clase.idEntrenador
                    };

                    try {
                        // Paso 1: Eliminar la clase antigua
                        const deleteRes = await fetch(`${API_BASE}/clases/${idClase}`, {
                            method: 'DELETE'
                        });

                        if (!deleteRes.ok) {
                            throw new Error('No se pudo eliminar la clase anterior');
                        }

                        // Paso 2: Crear la clase con los nuevos datos
                        const createRes = await fetch(`${API_BASE}/clases`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(claseData)
                        });

                        if (createRes.ok) {
                            closeModal();
                            showAlert('mainAlert', 'Clase actualizada exitosamente', 'success');
                            loadEntrenadorClases();
                        } else {
                            const error = await createRes.json();
                            // Si falla al crear, mostrar error
                            showAlert('mainAlert', 'Error al actualizar clase: ' + (error.message || 'Error desconocido'), 'error');
                        }
                    } catch (error) {
                        showAlert('mainAlert', 'Error al actualizar clase: ' + error.message, 'error');
                        console.error('Error:', error);
                        // Recargar para mostrar el estado actual
                        loadEntrenadorClases();
                    }
                });
            } catch (error) {
                showAlert('mainAlert', 'Error al cargar clase', 'error');
            }
        }

        async function eliminarClase(idClase) {
            if (!confirm('¬øEst√°s seguro de eliminar esta clase?')) return;

            try {
                const res = await fetch(`${API_BASE}/clases/${idClase}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    showAlert('mainAlert', 'Clase eliminada', 'success');
                    loadEntrenadorClases();
                } else {
                    showAlert('mainAlert', 'Error al eliminar clase', 'error');
                }
            } catch (error) {
                showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        }

        async function loadEntrenadores() {
            const entrenadoresDiv = document.getElementById('entrenadoresList');
            entrenadoresDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const res = await fetch(`${API_BASE}/entrenadores?size=100`);
                const data = await res.json();
                const entrenadores = data.content || [];

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Tel√©fono</th>
                                <th>Especialidad</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                entrenadores.forEach(entrenador => {
                    html += `
                        <tr>
                            <td>${entrenador.idSocio}</td>
                            <td>${entrenador.nombre} ${entrenador.apellidos}</td>
                            <td>${entrenador.email}</td>
                            <td>${entrenador.telefono}</td>
                            <td>${entrenador.especialidad}</td>
                            <td><span style="color: ${entrenador.esActivo ? '#48bb78' : '#f56565'}">${entrenador.esActivo ? 'Activo' : 'Inactivo'}</span></td>
                            <td>
                                <button class="btn btn-primary action-btn" onclick="editarEntrenador(${entrenador.idSocio})">Editar</button>
                                <button class="btn btn-danger action-btn" onclick="eliminarEntrenador(${entrenador.idSocio})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                entrenadoresDiv.innerHTML = html;
            } catch (error) {
                entrenadoresDiv.innerHTML = '<p style="color: red;">Error al cargar entrenadores</p>';
                console.error('Error:', error);
            }
        }

        async function showCreateEntrenadorForm() {
            let html = `
                <form id="createEntrenadorForm">
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="entNombre" required>
                    </div>
                    <div class="form-group">
                        <label>Apellidos *</label>
                        <input type="text" id="entApellidos" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="entEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono *</label>
                        <input type="tel" id="entTelefono" required>
                    </div>
                    <div class="form-group">
                        <label>Especialidad *</label>
                        <input type="text" id="entEspecialidad" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Crear Entrenador</button>
                </form>
            `;

            openModal('Nuevo Entrenador', html);

            document.getElementById('createEntrenadorForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const entrenadorData = {
                    nombre: document.getElementById('entNombre').value,
                    apellidos: document.getElementById('entApellidos').value,
                    email: document.getElementById('entEmail').value,
                    telefono: document.getElementById('entTelefono').value,
                    especialidad: document.getElementById('entEspecialidad').value
                };

                try {
                    const res = await fetch(`${API_BASE}/entrenadores`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(entrenadorData)
                    });

                    if (res.ok) {
                        closeModal();
                        showAlert('mainAlert', 'Entrenador creado exitosamente', 'success');
                        loadEntrenadores();
                    } else {
                        const error = await res.json();
                        showAlert('mainAlert', error.message || 'Error al crear entrenador', 'error');
                    }
                } catch (error) {
                    showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                    console.error('Error:', error);
                }
            });
        }

        async function editarEntrenador(idEntrenador) {
            try {
                const res = await fetch(`${API_BASE}/entrenadores/${idEntrenador}`);
                const entrenador = await res.json();

                let html = `
                    <form id="editEntrenadorForm">
                        <div class="form-group">
                            <label>Nombre</label>
                            <input type="text" id="editEntNombre" value="${entrenador.nombre}">
                        </div>
                        <div class="form-group">
                            <label>Apellidos</label>
                            <input type="text" id="editEntApellidos" value="${entrenador.apellidos}">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="editEntEmail" value="${entrenador.email}">
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono</label>
                            <input type="tel" id="editEntTelefono" value="${entrenador.telefono}">
                        </div>
                        <div class="form-group">
                            <label>Especialidad</label>
                            <input type="text" id="editEntEspecialidad" value="${entrenador.especialidad}">
                        </div>
                        <div class="form-group">
                            <label>Estado</label>
                            <select id="editEntActivo">
                                <option value="true" ${entrenador.esActivo ? 'selected' : ''}>Activo</option>
                                <option value="false" ${!entrenador.esActivo ? 'selected' : ''}>Inactivo</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Actualizar</button>
                    </form>
                `;

                openModal('Editar Entrenador', html);

                document.getElementById('editEntrenadorForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const updateData = {
                        nombre: document.getElementById('editEntNombre').value,
                        apellidos: document.getElementById('editEntApellidos').value,
                        email: document.getElementById('editEntEmail').value,
                        telefono: document.getElementById('editEntTelefono').value,
                        especialidad: document.getElementById('editEntEspecialidad').value,
                        esActivo: document.getElementById('editEntActivo').value === 'true'
                    };

                    try {
                        const res = await fetch(`${API_BASE}/entrenadores/${idEntrenador}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(updateData)
                        });

                        if (res.ok) {
                            closeModal();
                            showAlert('mainAlert', 'Entrenador actualizado', 'success');
                            loadEntrenadores();
                        } else {
                            const error = await res.json();
                            showAlert('mainAlert', error.message || 'Error al actualizar', 'error');
                        }
                    } catch (error) {
                        showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                        console.error('Error:', error);
                    }
                });
            } catch (error) {
                showAlert('mainAlert', 'Error al cargar entrenador', 'error');
            }
        }

        async function eliminarEntrenador(idEntrenador) {
            if (!confirm('¬øEst√°s seguro de eliminar este entrenador?')) return;

            try {
                const res = await fetch(`${API_BASE}/entrenadores/${idEntrenador}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    showAlert('mainAlert', 'Entrenador eliminado', 'success');
                    loadEntrenadores();
                } else {
                    showAlert('mainAlert', 'Error al eliminar entrenador', 'error');
                }
            } catch (error) {
                showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        }

        async function loadHorarios() {
            const horariosDiv = document.getElementById('horariosList');
            horariosDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const res = await fetch(`${API_BASE}/horarios`);
                const horarios = await res.json();

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Hora Inicio</th>
                                <th>Hora Fin</th>
                                <th>Duraci√≥n (min)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                horarios.forEach(horario => {
                    const duracion = calcularDuracion(horario.horaInicio, horario.horaFin);
                    html += `
                        <tr>
                            <td>${horario.idHorario}</td>
                            <td>${horario.horaInicio}</td>
                            <td>${horario.horaFin}</td>
                            <td>${duracion} min</td>
                            <td>
                                <button class="btn btn-danger action-btn" onclick="eliminarHorario(${horario.idHorario})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                horariosDiv.innerHTML = html;
            } catch (error) {
                horariosDiv.innerHTML = '<p style="color: red;">Error al cargar horarios</p>';
                console.error('Error:', error);
            }
        }

        function calcularDuracion(inicio, fin) {
            const [hI, mI] = inicio.split(':').map(Number);
            const [hF, mF] = fin.split(':').map(Number);
            return (hF * 60 + mF) - (hI * 60 + mI);
        }

        async function showCreateHorarioForm() {
            let html = `
                <form id="createHorarioForm">
                    <div class="form-group">
                        <label>Hora Inicio (HH:mm) *</label>
                        <input type="time" id="horarioInicio" required>
                    </div>
                    <div class="form-group">
                        <label>Hora Fin (HH:mm) *</label>
                        <input type="time" id="horarioFin" required>
                    </div>
                    <p style="color: #718096; margin: 10px 0; font-size: 0.9em;">
                        La duraci√≥n debe estar entre 15 y 180 minutos.
                    </p>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Crear Horario</button>
                </form>
            `;

            openModal('Nuevo Horario', html);

            document.getElementById('createHorarioForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const horarioData = {
                    horaInicio: document.getElementById('horarioInicio').value,
                    horaFin: document.getElementById('horarioFin').value
                };

                try {
                    const res = await fetch(`${API_BASE}/horarios`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(horarioData)
                    });

                    if (res.ok) {
                        closeModal();
                        showAlert('mainAlert', 'Horario creado exitosamente', 'success');
                        loadHorarios();
                    } else {
                        const error = await res.json();
                        showAlert('mainAlert', error.message || 'Error al crear horario', 'error');
                    }
                } catch (error) {
                    showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                    console.error('Error:', error);
                }
            });
        }

        async function eliminarHorario(idHorario) {
            if (!confirm('¬øEst√°s seguro de eliminar este horario?')) return;

            try {
                const res = await fetch(`${API_BASE}/horarios/${idHorario}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    showAlert('mainAlert', 'Horario eliminado', 'success');
                    loadHorarios();
                } else {
                    showAlert('mainAlert', 'Error al eliminar horario', 'error');
                }
            } catch (error) {
                showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        }

        async function loadSocios() {
            const sociosDiv = document.getElementById('sociosList');
            sociosDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const res = await fetch(`${API_BASE}/socios?size=100`);
                const data = await res.json();
                const socios = data.content || [];

                let html = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Tel√©fono</th>
                                <th>Plan</th>
                                <th>Estado</th>
                                <th>Fecha Alta</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                socios.forEach(socio => {
                    html += `
                        <tr>
                            <td>${socio.idSocio}</td>
                            <td>${socio.nombre} ${socio.apellidos}</td>
                            <td>${socio.email}</td>
                            <td>${socio.telefono}</td>
                            <td>${socio.tipoPlan}</td>
                            <td><span style="color: ${socio.esActivo ? '#48bb78' : '#f56565'}">${socio.esActivo ? 'Activo' : 'Inactivo'}</span></td>
                            <td>${new Date(socio.fechaAlta).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-primary action-btn" onclick="editarSocio(${socio.idSocio})">Editar</button>
                                <button class="btn btn-danger action-btn" onclick="eliminarSocio(${socio.idSocio})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                sociosDiv.innerHTML = html;
            } catch (error) {
                sociosDiv.innerHTML = '<p style="color: red;">Error al cargar socios</p>';
                console.error('Error:', error);
            }
        }

        async function editarSocio(idSocio) {
            try {
                const res = await fetch(`${API_BASE}/socios/${idSocio}`);
                const socio = await res.json();

                let html = `
                    <form id="editSocioForm">
                        <div class="form-group">
                            <label>Nombre</label>
                            <input type="text" id="editSocioNombre" value="${socio.nombre}">
                        </div>
                        <div class="form-group">
                            <label>Apellidos</label>
                            <input type="text" id="editSocioApellidos" value="${socio.apellidos}">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="editSocioEmail" value="${socio.email}">
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono</label>
                            <input type="tel" id="editSocioTelefono" value="${socio.telefono}">
                        </div>
                        <div class="form-group">
                            <label>Plan</label>
                            <select id="editSocioPlan">
                                <option value="BASICO" ${socio.tipoPlan === 'BASICO' ? 'selected' : ''}>B√ÅSICO</option>
                                <option value="PREMIUM" ${socio.tipoPlan === 'PREMIUM' ? 'selected' : ''}>PREMIUM</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estado</label>
                            <select id="editSocioActivo">
                                <option value="true" ${socio.esActivo ? 'selected' : ''}>Activo</option>
                                <option value="false" ${!socio.esActivo ? 'selected' : ''}>Inactivo</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Actualizar</button>
                    </form>
                `;

                openModal('Editar Socio', html);

                document.getElementById('editSocioForm').addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const updateData = {
                        nombre: document.getElementById('editSocioNombre').value,
                        apellidos: document.getElementById('editSocioApellidos').value,
                        email: document.getElementById('editSocioEmail').value,
                        telefono: document.getElementById('editSocioTelefono').value,
                        tipoPlan: document.getElementById('editSocioPlan').value,
                        esActivo: document.getElementById('editSocioActivo').value === 'true'
                    };

                    try {
                        const res = await fetch(`${API_BASE}/socios/${idSocio}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(updateData)
                        });

                        if (res.ok) {
                            closeModal();
                            showAlert('mainAlert', 'Socio actualizado', 'success');
                            loadSocios();
                        } else {
                            const error = await res.json();
                            showAlert('mainAlert', error.message || 'Error al actualizar', 'error');
                        }
                    } catch (error) {
                        showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                        console.error('Error:', error);
                    }
                });
            } catch (error) {
                showAlert('mainAlert', 'Error al cargar socio', 'error');
            }
        }

        async function eliminarSocio(idSocio) {
            if (!confirm('¬øEst√°s seguro de eliminar este socio?')) return;

            try {
                const res = await fetch(`${API_BASE}/socios/${idSocio}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    showAlert('mainAlert', 'Socio eliminado', 'success');
                    loadSocios();
                } else {
                    showAlert('mainAlert', 'Error al eliminar socio', 'error');
                }
            } catch (error) {
                showAlert('mainAlert', 'Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Add active class to selected tab
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });
    </script>
</body>
</html>

